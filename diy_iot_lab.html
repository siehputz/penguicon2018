<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>DIY IOT Lab &#8201;&#8212;&#8201;Penguicon 2018</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>DIY IOT Lab &#8201;&#8212;&#8201;Penguicon 2018</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Author    Dave Putz &lt;<a href="mailto:dwputz@gmail.com">dwputz@gmail.com</a>&gt;</p></div>
<div class="paragraph"><p>Author    Connie Sieh &lt;<a href="mailto:cjsieh@gmail.com">cjsieh@gmail.com</a>&gt;</p></div>
<div class="paragraph"><p>License
        <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p></div>
<div class="paragraph"><p><strong>Your  Station Name <em><em></em></em><em><em></em></em></strong></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_diy_iot_lab_outline">DIY IOT Lab Outline</h2>
<div class="sectionbody">
<div class="dlist"><div class="title">ESP8266 Arduino IDE , sensor,  Data Broker and Web Server Basics</div><dl>
<dt class="hdlist1">
Lab 1 
</dt>
<dd>
<p>
Familiarize yourself with the Arduino IDE, compiling, and uploading a program to the ESP8266
</p>
</dd>
<dt class="hdlist1">
Lab 2 
</dt>
<dd>
<p>
Program the ESP8266 to gather and report DHT11 data from a sensor
</p>
</dd>
<dt class="hdlist1">
Lab 3 
</dt>
<dd>
<p>
Program the ESP8266 to publish to a MQTT Broker
</p>
</dd>
<dt class="hdlist1">
Lab 4 
</dt>
<dd>
<p>
Program the ESP8266 to publish DHT11 Temperature sensor data to a MQTT Broker
</p>
</dd>
<dt class="hdlist1">
Lab 5 
</dt>
<dd>
<p>
Program the ESP8266 to be a Web Server
</p>
</dd>
<dt class="hdlist1">
Lab 6 
</dt>
<dd>
<p>
Program the ESP8266 to be a Access Point and a Web Server
</p>
</dd>
<dt class="hdlist1">
Lab 7 
</dt>
<dd>
<p>
Program the ESP8266 to display DHT11 sensor data via a local web server as a Access Point
</p>
</dd>
</dl></div>
<div class="dlist"><div class="title">Data Flow with Node-RED</div><dl>
<dt class="hdlist1">
Lab 8 
</dt>
<dd>
<p>
Familiarize yourself with Node-RED
</p>
</dd>
<dt class="hdlist1">
Lab 9 
</dt>
<dd>
<p>
Setup ESP8266 to publish to MQTT Broker, and configure a Node-RED flow to subscribe to MQTT and send email
</p>
</dd>
</dl></div>
<div class="dlist"><div class="title">ESP8266 No/Little Programming Frameworks</div><dl>
<dt class="hdlist1">
Lab 10 
</dt>
<dd>
<p>
Upload and configure ESPeasy to send DHT11 sensor data to MQTT Broker
</p>
</dd>
</dl></div>
<div class="dlist"><div class="title">Final Step</div><dl>
<dt class="hdlist1">
LAB 11 
</dt>
<dd>
<p>
Configure a Node-Red flow to subscribe to a MQTT broker and publish to the cloud
</p>
</dd>
</dl></div>
<div class="tableblock">
<table rules="all"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Which labs go with each track</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top"> From the beginning </th>
<th align="left" valign="top"> No Programming  </th>
<th align="left" valign="top"> Been Here Before</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Lab 1</p></td>
<td align="left" valign="top"><p class="table">Lab 1</p></td>
<td align="left" valign="top"><p class="table">Lab 1</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 2</p></td>
<td align="left" valign="top"><p class="table">Lab 10</p></td>
<td align="left" valign="top"><p class="table">Lab 4</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 3</p></td>
<td align="left" valign="top"><p class="table">Lab 8</p></td>
<td align="left" valign="top"><p class="table">Lab 9 (With options)</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 4</p></td>
<td align="left" valign="top"><p class="table">Lab 9</p></td>
<td align="left" valign="top"><p class="table">Lab 11</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 5</p></td>
<td align="left" valign="top"><p class="table">Lab 11</p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 6</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 7</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 8</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 9</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Lab 11</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table"></p></td>
</tr>
</tbody>
</table>
</div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_1_arduino_ide_compiling_and_uploading_a_program_to_the_esp8266">LAB 1 :: Arduino IDE, compiling, and uploading a program to the ESP8266</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Log into the lab system with
</p>
<div class="ulist"><ul>
<li>
<p>
user: arduino
</p>
</li>
<li>
<p>
password: arduino
</p>
</li>
</ul></div>
</li>
<li>
<p>
Plug in the ESP8266 using the USB cable
</p>
</li>
<li>
<p>
Double click on the Arduino IDE icon to bring up the IDE, might be under
</p>
<div class="ulist"><ul>
<li>
<p>
<em>Activities&#8594;Show Programs</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Click on <em>Tools&#8594;Board</em> and pick
</p>
<div class="ulist"><ul>
<li>
<p>
“NodeMCU 1.0 (ESP 12-E Module)”
</p>
</li>
</ul></div>
</li>
<li>
<p>
Click on Tools and make sure
</p>
<div class="ulist"><ul>
<li>
<p>
"Upload Speed" is set to
</p>
<div class="ulist"><ul>
<li>
<p>
115200
</p>
</li>
</ul></div>
</li>
<li>
<p>
"Port" is set to
</p>
<div class="ulist"><ul>
<li>
<p>
/dev/ttyUSB0 or
</p>
</li>
<li>
<p>
/dev/ttyUSB1
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on <em>File&#8594;Examples&#8594;ESP8266&#8594;Blink</em> This should bring up a code window with the “Blink” program loaded.
</p>
</li>
<li>
<p>
Take a look at this small program(sketch). Note that it has two main functions . All ESP8266 sketches will contain at least these two functions.
</p>
<div class="ulist"><ul>
<li>
<p>
setup() function, which is run once when the sketch starts
</p>
</li>
<li>
<p>
loop() function, which is run in a loop after setup completes
</p>
</li>
</ul></div>
</li>
<li>
<p>
Click on the 'Check” icon on the toolbar to compile the sketch(program).
</p>
<div class="ulist"><ul>
<li>
<p>
If you see no errors in the output window, click on the “Right Arrow” icon on the toolbar to upload the program to your ESP8266. You should see a progress indicator in the output window and the Blue LED (near antenna) blinking on the ESP8266.
</p>
</li>
<li>
<p>
When the upload completes, the ESP8266 will start running the program. You should see the Red or Blue(near usb connector) LED turning off and on with a pause of one second between changes.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Edit the program to change the timing of the blinks. This will be done with the two lines that currently read
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>delay(1000);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
change it to whatever you like.
</p>
</li>
</ul></div>
<div class="olist arabic"><ol class="arabic" start="10">
<li>
<p>
Compile and upload the modified program.
TIP: Can just click on the "upload arrow", and the IDE will compile before uploading
</p>
</li>
<li>
<p>
Verify that the LED blink rate on your ESP8266 has successfully changed.
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_2_dht11_temperature_and_humidity_sensor">LAB 2 :: DHT11(Temperature and Humidity) Sensor</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Load the example program for a DHT sensor.
</p>
<div class="ulist"><ul>
<li>
<p>
Click on <em>File&#8594;Examples&#8594;DHT sensor library&#8594;DHTtester</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
uncomment(remove the //) on the
</p>
<div class="ulist"><ul>
<li>
<p>
define line for DHTTYPE DHT11
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>//#define DHTTYPE DHT11</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTTYPE DHT11</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="3">
<li>
<p>
comment(Insert //) on the
</p>
<div class="ulist"><ul>
<li>
<p>
define line for DHTTYPE for DHT22
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTTYPE DHT22</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>//#define DHTTYPE DHT22</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">It is a good programming practice to use defined values for pin numbers rather than actual numbers</td>
</tr></table>
</div>
<div class="olist arabic"><ol class="arabic" start="4">
<li>
<p>
change
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTPIN 2</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTPIN D5</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The DHT11 sensor is connected to GPIO(General Purpuse IO) pin D5</td>
</tr></table>
</div>
<div class="olist arabic"><ol class="arabic" start="5">
<li>
<p>
Because we are using a baud rate of 115200, you need to change
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>Serial.begin(9600);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>Serial.begin(115200);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="6">
<li>
<p>
Compile and upload the sketch(program).
</p>
</li>
<li>
<p>
Open the serial monitor window by clicking on <em>Tools&#8594;Serial Monitor</em>.
</p>
<div class="ulist"><ul>
<li>
<p>
You should see the temperature and humidity readings being displayed. Note that the Serial.print() functions in your program will always display to this monitor window.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Try holding the sensor in your hand and/or blowing on it to see the readings change. Be careful not to detach any wires when doing this.
</p>
</li>
<li>
<p>
Click on <em>File&#8594;Save As</em> and save it as &#8216;lab2&#8217; in your Documents folder to save this version
&lt;&lt;&lt;
&lt;&lt;&lt;
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_3_mqtt_with_an_incremented_number_for_testing">LAB 3 ::  MQTT with an incremented number for testing</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Switch your station to the “iotlab” network by going to “Network Manager” Icon at top right of screen and selecting
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
SSID “iotlab”
</p>
</li>
<li>
<p>
PASS “iotlabpass”
</p>
</li>
</ol></div>
</li>
<li>
<p>
Click on <em>File&#8594;Examples&#8594;Adafruit MQTT Library&#8594;mqtt_esp8266</em>
</p>
</li>
<li>
<p>
Read through the source code. Note that this example was written to use a specific MQTT broker (io.adafruit.com) (most MQTT Brokers are compatible).  We are going to communicate with a local MQTT Broker called Mosquitto running on your station.
</p>
</li>
<li>
<p>
Configure the ESP8266 Wifi to use the local lab network.  Change the program  at lines 24 and 25
</p>
<div class="ulist"><ul>
<li>
<p>
WLAN_SSID: iotlab    (SSID of our created lab network)
</p>
</li>
<li>
<p>
WLAN_PASS: iotlabpass    (PASS of our created lab network)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Configure the ESP8266 to communicate to a MQTT server.   You will use a MQTT Broker that is on the local  iotlab network.  Change line 29 and 31
</p>
<div class="ulist"><ul>
<li>
<p>
AIO_SERVER
</p>
<div class="ulist"><ul>
<li>
<p>
Use your station 192.168.x.x ipaddress
</p>
<div class="ulist"><ul>
<li>
<p>
“ip addr” to get ip addresses of your station in a terminal window
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
AIO_USERNAME
</p>
<div class="ulist"><ul>
<li>
<p>
User your station name
</p>
</li>
</ul></div>
</li>
<li>
<p>
AIO_KEY (empty)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Change the name of your MQTT topic, which is done in the call to
</p>
<div class="ulist"><ul>
<li>
<p>
Adafruit_MQTT_Publish().    Line 48
</p>
<div class="ulist"><ul>
<li>
<p>
Change the name to “temp”
</p>
</li>
<li>
<p>
Change the literal from “feeds/photocell” to “feeds/temp”
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="all"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>Adafruit_MQTT_Publish photocell = Adafruit_MQTT_Publish(&amp;mqtt, AIO_USERNAME "/feeds/photocell");</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>Adafruit_MQTT_Publish temp = Adafruit_MQTT_Publish(&amp;mqtt, AIO_USERNAME "/feeds/temp");</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Change line 107 to call "temp.publish" instead of "photocell.publish" since we changed the name to temp earlier .
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="all"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>if (! photocell.publish(x++)) {</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>if (! temp.publish(x++)) {</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Put in a 15-second delay between each publishing
</p>
</li>
<li>
<p>
Click on <em>File&#8594;Save As</em> and save this version as &#8216;lab3&#8217; in your Documents folder
</p>
</li>
<li>
<p>
Compile and upload the sketch(program)
</p>
</li>
<li>
<p>
Keep the serial monitor window open so you can see any displayed messages or errors
</p>
</li>
<li>
<p>
You should now be publishing the result of <em>x++</em> to a <em>mosquitto MQTT broker</em> on your lab station
</p>
</li>
<li>
<p>
You can check this by


</p>
<div class="ulist"><ul>
<li>
<p>
open a terminal window on the system and entering the command
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="60%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>mosquitto_sub -h localhost -v -u stationxx -P stationxxpass -t <em>#</em></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
</ul></div>
<div class="paragraph"><p>NOTE:</p></div>
<div class="listingblock">
<div class="content">
<pre><code> -h localhost  -- &lt;name/ipaddress of mqtt broker system&gt;
 -v            -- &lt;verbose&gt;
 -t '#'        -- &lt;topic&gt; '#' means all topics</code></pre>
</div></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_4_mqtt_amp_dht11">LAB 4 ::  MQTT &amp; DHT11</h2>
<div class="sectionbody">
<div class="olist arabic"><div class="title">Add/Change DHT code to MQTT code from LAB 3</div><ol class="arabic">
<li>
<p>
Add in the necessary DHT code. You can cut &amp; paste from the DHT example.
</p>
<div class="ulist"><ul>
<li>
<p>
Definitions
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#include "DHT.h"</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTPIN D5</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTTYPE DHT11</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>DHT dht(DHTPIN, DHTTYPE);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
Initialization of the DHT
</p>
<div class="ulist"><ul>
<li>
<p>
Add to setup(); the following code
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>dht.begin();</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
Add the read from the DHT to loop();
</p>
</li>
<li>
<p>
Above the comment line in the loop() that follows
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>// Now we can publish stuff!”</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
add the code from Lab 3 that reads the temperature from the DHT sensor
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>// Read temperature as Fahrenheit (isFahrenheit = true)</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float f = dht.readTemperature(true);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>if (isnan(f)) {</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>Serial.println("Failed to read from DHT sensor!");</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
Change the temp.publish line from "x++" to "f" since the DHT11 temp is in "f"
</p>
</li>
<li>
<p>
from
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>if (! photocell.publish(x++)) {</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
to
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>if (! temp.publish(f)) {</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="2">
<li>
<p>
Compile and upload the sketch. Check your mosquitto_sub screen from Lab 3 to see that the sequential numbers have changed to temperatures.
</p>
</li>
<li>
<p>
Click on <em>File&#8594;Save As</em> and save as &#8216;lab4&#8217; in your Documents folder
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_5_esp8266_running_a_web_server">LAB 5 :: ESP8266 running a Web Server</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Load the example ESP8266 web server sketch <em>File&#8594;Examples&#8594;ESP8266WebServer&#8594;HelloServer</em>
</p>
</li>
<li>
<p>
Look at the code. Note in particular that the loop() function consists of only a single function call.
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>server.handleClient();</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Modify the values assigned to
</p>
<div class="ulist"><ul>
<li>
<p>
SSID “iotlab”
</p>
</li>
<li>
<p>
PASS “iotlabpass”
</p>
</li>
</ul></div>
</li>
<li>
<p>
Compile and upload the sketch
</p>
</li>
<li>
<p>
Since multiple stations may be running this code at the same time, you will need to look at the serial monitor when the sketch starts running to see what IP address was assigned to it. The IPADDRESS is provided by the iotlab router via  dhcp.
</p>
</li>
<li>
<p>
Using a smartphone or tablet or your station  connect to
</p>
<div class="ulist"><ul>
<li>
<p>
SSID:  iotlab
</p>
</li>
<li>
<p>
PASS:  iotlabpass
</p>
</li>
</ul></div>
</li>
<li>
<p>
enter your ESP8266&#8217;s IP address in the URL bar.
</p>
<div class="ulist"><ul>
<li>
<p>
You should see a screen back that contains just a hello message. Note that this response was created by the handleRoot() function in the sketch, which was assigned to the root page by the line:
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>server.on("/", handleRoot);.</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="6">
<li>
<p>
Click on <em>File&#8594;Save As</em>   to save this version
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_6_esp8266_as_a_access_point_and_web_server">LAB 6 :: ESP8266 as a Access Point and Web Server</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Load the example <em>File&#8594;Examples&#8594;ESP8266Wifi&#8594;WiFiAccessPoint</em> and look at the differences in the wifi initialization.
</p>
<div class="ulist"><ul>
<li>
<p>
You will need to make your own "network" since the ESP will be a Access Point
</p>
<div class="ulist"><ul>
<li>
<p>
ssid (use your station name)
</p>
</li>
<li>
<p>
password (your choice)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Insert
</p>
<div class="ulist"><ul>
<li>
<p>
Since the default IPADDRESS is 192.168.4.1 you will need to change that since there are many EPS8266 in the lab.
</p>
</li>
<li>
<p>
Insert the following 3 lines; where xx is replaced by your station number , just to make it unique
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>IPAddress apIP(192,168,xx,1);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi.mode(WIFI_AP_STA);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
before
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi.softAP(ssid, password);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="ulist"><ul>
<li>
<p>
It should now look like
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>IPAddress apIP(192,168,xx,1);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi.mode(WIFI_AP_STA);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi.softAPConfig(apIP, apIP, IPAddress(255, 255, 255, 0));</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>WiFi,softAP(ssid,password);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="3">
<li>
<p>
Compile and upload the sketch
</p>
</li>
<li>
<p>
Using a smartphone or tablet or your station  connect to
</p>
<div class="ulist"><ul>
<li>
<p>
the network with the SSID and the password you created
</p>
</li>
<li>
<p>
Enter the IP address you specified in a web browser
</p>
<div class="ulist"><ul>
<li>
<p>
You should see a screen back that contains just a hello message
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on <em>File&#8594;Save As</em> and save it as &#8216;lab6&#8217; in your Documents directory
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_7_esp8266_as_a_access_point_and_web_server_displaying_dht11_data">LAB 7 ::  ESP8266 as a Access Point and Web Server displaying DHT11 data</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_change_the_lab_6_program_to_return_temperature_and_humidity_readings_when_a_page_other_than_the_root_page_is_used">Change the LAB 6 program to return temperature and humidity readings when a page other than the root page is used.</h3>
<div class="olist arabic"><div class="title">Copy &amp; paste the necessary DHT lines from the DHT example as you did in Lab 4.</div><ol class="arabic">
<li>
<p>
Add the DHT definition lines
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>#include "DHT.h"</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTPIN D5</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>#define DHTTYPE DHT11</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>DHT dht(DHTPIN, DHTTYPE);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="2">
<li>
<p>
Add the DHT initalize to setup();
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>dht.begin();</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="3">
<li>
<p>
Add the code to read the DHT11 sensor to a new handleTemp() function
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>void handleTemp() {</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float h = dht.readHumidity();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float f = dht.readTemperature(true);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="4">
<li>
<p>
Add server.send() call to handleTemp() to send the data back to the client when the web page requests it
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://links2004.github.io/Arduino/d3/d58/class_e_s_p8266_web_server.html">https://links2004.github.io/Arduino/d3/d58/class_e_s_p8266_web_server.html</a>
</p>
</li>
</ul></div>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>void handleTemp() {</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>String message = "";</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float h = dht.readHumidity();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>float f = dht.readTemperature(true);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>message = "Temperature is : ";</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>message += f;</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>message += " Humidity is : ";</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>message += h;</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>message += "\n" ;</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>server.send(200, "text/plain", message);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="5">
<li>
<p>
Call handleTemp in setup() after server.on("/", handleRoot) when user enters URL ending in <strong>/temp</strong>
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>server.on("/", handleRoot);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>server.on("/temp", handleTemp);</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="6">
<li>
<p>
Compile and upload the sketch.
</p>
</li>
<li>
<p>
Using a smartphone or tablet or lab station connect to the wifi network with the SSID and password you created.
</p>
</li>
<li>
<p>
Enter the IP address followed by “/temp” in the URL bar. This should return your web page with the data from the DHT displayed.
</p>
</li>
<li>
<p>
Click on <em>Save As</em> and save this as &#8216;lab7&#8217; in your Documents directory
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_8_familiarize_yourself_with_node_red">LAB 8 :: Familiarize Yourself with Node-RED</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_basic_node_red_flow_and_see_how_to_connect_nodes">Create a basic Node-RED flow and see how to connect nodes</h3>
<div class="olist arabic"><ol class="arabic" start="1">
<li>
<p>
To start Node-RED
</p>
<div class="ulist"><ul>
<li>
<p>
In a terminal window type
</p>
<div class="ulist"><ul>
<li>
<p>
node node_modules/node-red/red
</p>
</li>
</ul></div>
</li>
<li>
<p>
Using a browser
</p>
<div class="ulist"><ul>
<li>
<p>
go to "http://127.0.0.1:1880/" to navigate to the Node-RED screen
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Open a browser on your lab system.
</p>
</li>
<li>
<p>
Note that 1880 is the default port for Node-RED, and can be changed in the settings.js
file.
</p>
</li>
<li>
<p>
You will see the Node-RED screen, with node choices on the left,
the design screen in the middle, and info and debug tabs on the
right.
</p>
</li>
<li>
<p>
Click and drag an &#8216;inject&#8217; input node onto the design screen.
</p>
</li>
<li>
<p>
Double clicking on the new node will bring up an edit window on
the screen. For now, just change the name to &#8216;Time&#8217; and click &#8216;Done&#8217;.
</p>
</li>
<li>
<p>
Click and drag a &#8216;debug&#8217; output node onto the design screen.
</p>
</li>
<li>
<p>
Change its name to &#8216;Test&#8217;.
</p>
</li>
<li>
<p>
Connect the two nodes by clicking on the right side of the &#8216;Time&#8217;
node and dragging a line to the left side of the &#8216;Test&#8217; node.
</p>
</li>
<li>
<p>
Click on the &#8216;Deploy&#8217; button on the top right. Note that in
Node-RED no changes take effect until they are deployed.
</p>
</li>
<li>
<p>
Click on the &#8216;debug&#8217; tab on the right side to show the debug
screen.
</p>
</li>
<li>
<p>
Click on the button on the left side of the &#8216;Time&#8217; node. This
activates that node. Look at the debug window to see the
timestamp displayed.
</p>
</li>
</ol></div>
<div class="sect3">
<h4 id="_part_2_modify_the_flow_to_add_a_function_node">Part 2 ::Modify the flow to add a function node</h4>
<div class="olist arabic"><ol class="arabic" start="1">
<li>
<p>
Click on the line between the two nodes, and hit &#8216;delete&#8217; on
the keyboard to remove it.
</p>
</li>
<li>
<p>
Click and drag a function node between the two existing
nodes. You can move the existing nodes around on the screen if
needed to make space.
</p>
</li>
<li>
<p>
Double-click on the function node to bring up the edit
window, and enter the following code:
</p>
</li>
</ol></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>// Create a Date object from the payload</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>var date = new Date(msg.payload);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>// Change the payload to be a formatted Date string</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>msg.payload = date.toString();</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>// Return the message so it can be sent on</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>return msg;</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="4">
<li>
<p>
Click &#8216;Done&#8217;, and then connect the output of the &#8216;Time&#8217;
node to the input of the function node, and the output of the
function node to the input of the &#8216;Test&#8217; node.
</p>
</li>
<li>
<p>
Deploy the flow, then click on the activate button on the
&#8216;Time&#8217; node. You should now see a formatted date in the debug
window.
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_9_setup_esp8266_to_publish_to_mqtt_broker_and_configure_a_node_red_flow_to_subscribe_to_mqtt_and_send_email">LAB 9 :: Setup ESP8266 to publish to MQTT broker, and configure a Node-RED flow to subscribe to MQTT and send email</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic" start="1">
<li>
<p>
If you are not using ESPEasy, reload the MQTT sketch from Lab 4 into your ESP8266. If you are using ESPEasy, just go to line 2.


</p>
<div class="ulist"><ul>
<li>
<p>
Using a browser
</p>
<div class="ulist"><ul>
<li>
<p>
go to "http://127.0.0.1:1880/" to navigate to the Node-RED screen
</p>
<div class="ulist"><ul>
<li>
<p>
If Node-RED is not running see the begining of lab 8
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
On your Node-RED screen, click on the “+” button on the top right of the design screen to open another flow.
</p>
</li>
<li>
<p>
Double-click on the "flow name" to bring up its edit window. Change the name to “MQTT-Test”. Note that this is also where you would delete a flow that you no longer want. Click “Done”.
</p>
</li>
<li>
<p>
Drag a "mqtt node" from the input list onto the workspace screen. Note that there is also a mqtt node in the output section, which we do not want to use here.
</p>
</li>
<li>
<p>
Double-click on the "mqtt node" to bring up the edit window.
</p>
<div class="ulist"><ul>
<li>
<p>
Since your mosquitto broker and Node-RED are running on the same system, click on the edit icon and enter a servername of &#8216;localhost&#8217;; then click &#8216;Add&#8217;.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Enter the topic name you used from Lab 3 in the "Topic box".
</p>
</li>
<li>
<p>
Change the "QOS" from 2 to 0.
</p>
</li>
<li>
<p>
Change the "name" to “MQTT subscribe” and hit “Done”.
</p>
</li>
<li>
<p>
Click and drag an "e-mail output node" from the “social” group. Note that you may have to scroll down to see this one. Also, make sure you get the output node (connector on the left) and not the input node (connector on the right).
</p>
</li>
<li>
<p>
Double-click the "email node" to bring up the edit window.
</p>
</li>
<li>
<p>
Enter your own email address in the “To” box, “penguiconlab1” in the Userid box, and “Test.123!” in the password box.
</p>
</li>
<li>
<p>
Change the name to gmail-out, and click “Done”
</p>
</li>
<li>
<p>
Connect the two nodes, and DEPLOY.
</p>
</li>
<li>
<p>
Log into your email account, and check for incoming messages. Note that you could be getting one every 15 seconds, so if it is working you may want to unplug the ESP8266 after a few emails, or change the delay timer in your sketch.
</p>
</li>
</ol></div>
<div class="sect2">
<h3 id="_further_possibilities_if_time_permits_you_may_want_to_try_out_other_nodes_some_suggestions">Further possibilities - If time permits, you may want to try out other nodes. Some suggestions:</h3>
<div class="paragraph"><p>A)  Add a switch node to test on the message from the MQTT broker; and only email if it exceeds some value. Send all other values to a debug node.</p></div>
<div class="paragraph"><p>B)  Add a function node to convert the temperature from what your are getting (either Fahrenheit or Celsius ) to the other scale.
   One possible function to do this</p></div>
<div class="tableblock">
<table rules="none"
width="50%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>// convert Celsius to Farenheit</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>var newtemp = new int (msg.payload);</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>msg.payload= (newtemp * 1.8) + 32;</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>return msg;</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>C) Insert an rbe (report-by-exception) node to only pass on the message if the temperature has changed.</p></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_10_esp8266_using_espeasy_framework">LAB 10 ::  ESP8266 Using ESPeasy Framework</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_install_and_configure_espeasy_to_send_dht11_sensor_data_to_a_mqtt_broker">Install and Configure ESPeasy to send DHT11 sensor data to a MQTT broker</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The downloads in steps 1-3 have been done for you - these steps are included for your reference.
. Look at <a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy#Get_started">https://www.letscontrolit.com/wiki/index.php/ESPEasy#Get_started</a></td>
</tr></table>
</div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Upload the precompiled ESPeasy firmware to esp8266
</p>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Precompiled image is located at <a href="http://www.letscontrolit.com/downloads/ESPEasy_R120.zip">http://www.letscontrolit.com/downloads/ESPEasy_R120.zip</a> .  This has already been downloaded and unziped to your stations. A Linux script has been included to install this firmware to the esp8266 as mentioned at <a href="https://www.letscontrolit.com/wiki/index.php/Tutorial_ESPEasy_Firmware_Upload">https://www.letscontrolit.com/wiki/index.php/Tutorial_ESPEasy_Firmware_Upload</a> .</td>
</tr></table>
</div>
<div class="olist arabic"><ol class="arabic" start="3">
<li>
<p>
Look at <a href="https://www.letscontrolit.com/wiki/index.php/Tutorial_ESPEasy_Firmware_Upload">https://www.letscontrolit.com/wiki/index.php/Tutorial_ESPEasy_Firmware_Upload</a>
</p>
<div class="ulist"><ul>
<li>
<p>
You have a nodemcu version of esp8266 so we have to select
</p>
<div class="ulist"><ul>
<li>
<p>
4096K version of the ESPeasy firmware in the next step
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Start a terminal window
</p>
</li>
<li>
<p>
Run espeasyflash.sh
</p>
<div class="ulist"><ul>
<li>
<p>
espeasyflash script will ask for
</p>
<div class="ulist"><ul>
<li>
<p>
USB Serial port to upload to
</p>
<div class="ulist"><ul>
<li>
<p>
/dev/ttyUSB0 or
</p>
</li>
<li>
<p>
/dev/ttyUSB1
</p>
<div class="ulist"><ul>
<li>
<p>
Determine which serial port with
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ol></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>ls /dev/ttyUSB<span style="color: #990000">*</span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
Firmware to upload
</p>
<div class="ulist"><ul>
<li>
<p>
0 ESPEasy_R147_4096.bin
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="tableblock">
<table rules="none"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="100%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table"><code>cd diyiot/Downloads/images/esp8266-frameworks/espeasy</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table"><code>./espeasyflash.sh</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="olist arabic"><ol class="arabic" start="6">
<li>
<p>
After flash is done
</p>
<div class="ulist"><ul>
<li>
<p>
Start Arduino Serial Console
</p>
<div class="ulist"><ul>
<li>
<p>
<strong>AFTER</strong> all of the flash clearing is done and you see
</p>
<div class="ulist"><ul>
<li>
<p>
<em>wdt reset</em>
</p>
<div class="ulist"><ul>
<li>
<p>
Reboot esp8266 via reset button
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Configure ESPeasy running on your esp8266 via ESP Easy web interface
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Configure Network Settings
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy#Config_page">https://www.letscontrolit.com/wiki/index.php/ESPEasy#Config_page</a>
</p>
<div class="ulist"><ul>
<li>
<p>
Using a tablet or smart phone or your station look for WIFI networks with a
SSID of ESP_0 ( this might be confusing if many do this at the same time)
</p>
</li>
<li>
<p>
Connect to ESP_0 wifi network
</p>
<div class="ulist"><ul>
<li>
<p>
Password is <em>configesp</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
In a web browser go to 192.168.4.1  (default ip address ,  might be confusing if many do this at the same time)
</p>
<div class="ulist"><ul>
<li>
<p>
Should see <em>Welcome to ESP Easy:newdevice</em>
</p>
<div class="ulist"><ul>
<li>
<p>
Click on <em>iotlab</em>  Network
</p>
</li>
<li>
<p>
Password <em>iotlabpass</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Click on <em>Connect</em>
</p>
<div class="ulist"><ul>
<li>
<p>
Should get a "Please wait for &#8230; while trying to connect"
</p>
</li>
<li>
<p>
Note the IP ADDRESS given by dhcp
</p>
</li>
</ul></div>
</li>
<li>
<p>
Using a tablet, smart phone or your station switch to the Network with SSID
</p>
<div class="ulist"><ul>
<li>
<p>
iotlab
</p>
</li>
<li>
<p>
Password <em>iotlabpass</em>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Review this first screen
</p>
</li>
<li>
<p>
Click on <em>Config</em>
</p>
<div class="ulist"><ul>
<li>
<p>
Change "Name" to
</p>
<div class="ulist"><ul>
<li>
<p>
easyxx
</p>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Change "Admin Password" to
</p>
<div class="ulist"><ul>
<li>
<p>
easyxxpass
</p>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
"SSID" should already be
</p>
<div class="ulist"><ul>
<li>
<p>
iotlab
</p>
</li>
</ul></div>
</li>
<li>
<p>
"WPA Key" should already be
</p>
<div class="ulist"><ul>
<li>
<p>
iotlabpass
</p>
</li>
</ul></div>
</li>
<li>
<p>
Change "Protocol"
</p>
<div class="ulist"><ul>
<li>
<p>
"OpenHab MQTT"
</p>
</li>
</ul></div>
</li>
<li>
<p>
Change "Controller IP"
</p>
<div class="ulist"><ul>
<li>
<p>
your station 192.168.10.x" address, address was assigned via dhcp
</p>
</li>
</ul></div>
</li>
<li>
<p>
Should already have "Controller Port" set to
</p>
<div class="ulist"><ul>
<li>
<p>
1883
</p>
<div class="ulist"><ul>
<li>
<p>
MQTT default port
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Change "Controller User"
</p>
<div class="ulist"><ul>
<li>
<p>
stationxx
</p>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Change "Controller Password"
</p>
<div class="ulist"><ul>
<li>
<p>
stationxxpass
</p>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on "<strong>Submit</strong>" at botton of page to save settings to esp8266 flash
</p>
</li>
<li>
<p>
Bring up Arduino console window to determine IP address assigned via dhcp on next reboot
</p>
</li>
<li>
<p>
Reboot by pressing "reset" button or via "Tools" tab "Reboot" button
</p>
</li>
<li>
<p>
Login to esp8266 as with ipaddress that Arduino Console shows
</p>
<div class="ulist"><ul>
<li>
<p>
esp8266 is now on iotlab network
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Configure Hardware settings Boot State (GPIO pins)
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy#Config_page">https://www.letscontrolit.com/wiki/index.php/ESPEasy#Config_page</a>
</p>
</li>
<li>
<p>
There should not be any need to change these for this lab
</p>
</li>
</ul></div>
</li>
<li>
<p>
Configure Devices settings
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy#Devices_page">https://www.letscontrolit.com/wiki/index.php/ESPEasy#Devices_page</a>
</p>
<div class="ulist"><ul>
<li>
<p>
Click on the 'Devices" tab
</p>
<div class="ulist"><ul>
<li>
<p>
Click on "Edit" of "Task 1"
</p>
<div class="ulist"><ul>
<li>
<p>
Select Device
</p>
<div class="ulist"><ul>
<li>
<p>
"Temperature &amp; Humidity - DHT"
</p>
</li>
</ul></div>
</li>
<li>
<p>
Name
</p>
<div class="ulist"><ul>
<li>
<p>
&lt;what ever you want&gt;
</p>
</li>
</ul></div>
</li>
<li>
<p>
Delay
</p>
<div class="ulist"><ul>
<li>
<p>
time in miliseconds
</p>
</li>
<li>
<p>
500
</p>
</li>
</ul></div>
</li>
<li>
<p>
IDX/Var
</p>
<div class="ulist"><ul>
<li>
<p>
1 &#8201;&#8212;&#8201; It is the first so 1 is good
</p>
</li>
</ul></div>
</li>
<li>
<p>
1st GPIO
</p>
<div class="ulist"><ul>
<li>
<p>
GPIO-14
</p>
</li>
<li>
<p>
which is (D5) (look on Pin diagram)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Send Data
</p>
<div class="ulist"><ul>
<li>
<p>
checked
</p>
</li>
<li>
<p>
sends data to protocol/controller defined in "Network Settings"
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Optional Settings
</p>
<div class="ulist"><ul>
<li>
<p>
Formula Temperature  -  Since DHT library defaults to Celcius could change
</p>
<div class="ulist"><ul>
<li>
<p>
%value% * 9/5 + 32
</p>
</li>
</ul></div>
</li>
<li>
<p>
Value Name 1 &#8201;&#8212;&#8201;Will show as name used in MQTT
</p>
<div class="ulist"><ul>
<li>
<p>
Should already be <em>Temperature</em>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Value Name 2 &#8201;&#8212;&#8201;Will show as name used in MQTT
</p>
<div class="ulist"><ul>
<li>
<p>
Should already be <em>Humidity</em>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on <strong>Submit</strong> to save
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Configure Tools settings
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy#Tools_page">https://www.letscontrolit.com/wiki/index.php/ESPEasy#Tools_page</a>
</p>
</li>
<li>
<p>
Click on the 'Tools" tab
</p>
<div class="ulist"><ul>
<li>
<p>
System/Advanced
</p>
<div class="ulist"><ul>
<li>
<p>
Look it over&#8201;&#8212;&#8201;no changes needed for lab
</p>
</li>
</ul></div>
</li>
<li>
<p>
Settings/Save
</p>
<div class="ulist"><ul>
<li>
<p>
Can save setting for later reload via Settings/Load
</p>
</li>
<li>
<p>
Good idea so as to not have to enter by hand again
</p>
</li>
</ul></div>
</li>
<li>
<p>
Firmware Load
</p>
<div class="ulist"><ul>
<li>
<p>
Allows for OTA (Over the Air) updates
</p>
</li>
</ul></div>
</li>
<li>
<p>
Command
</p>
<div class="ulist"><ul>
<li>
<p>
Can enter commands , mostly for testing
</p>
<div class="ulist"><ul>
<li>
<p>
See <a href="https://www.letscontrolit.com/wiki/index.php/ESPEasy_Command_Reference">https://www.letscontrolit.com/wiki/index.php/ESPEasy_Command_Reference</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on <strong>Submit</strong> to save
</p>
</li>
<li>
<p>
Bring up Arduino console window to note boot messages
</p>
</li>
<li>
<p>
Reboot by pressing "reset" button or via "Tools" tab "Reboot" button
</p>
</li>
</ul></div>
</li>
</ol></div>
</li>
<li>
<p>
Check that esp8266 is reading the DHT11 and sending data to MQTT
</p>
<div class="ulist"><ul>
<li>
<p>
Login to esp8266 as with ipaddress that Arduino Console shows
</p>
<div class="ulist"><ul>
<li>
<p>
esp8266 is now on iotlab network
</p>
</li>
</ul></div>
</li>
<li>
<p>
Click on Tools/Advanced
</p>
<div class="ulist"><ul>
<li>
<p>
Change "Serial Log Level"
</p>
<div class="ulist"><ul>
<li>
<p>
4
</p>
</li>
</ul></div>
</li>
<li>
<p>
Change "Web Log Level"
</p>
<div class="ulist"><ul>
<li>
<p>
4
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Click on <strong>Submit</strong> to save
</p>
</li>
<li>
<p>
Bring up Arduino Serial console window to see serial log messages
</p>
</li>
<li>
<p>
Reboot by pressing "reset" button or via "Tools" tab "Reboot" button
</p>
<div class="ulist"><ul>
<li>
<p>
Should see MQTT messages (along with others)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
Check that MQTT on your station is receiving data from the esp8266
</p>
<div class="ulist"><ul>
<li>
<p>
On your station in a terminal window
</p>
<div class="ulist"><ul>
<li>
<p>
mosquitto_sub -h localhost -u stationxx -P stationxxpass -v -t <em>'#</em>'
</p>
<div class="ulist"><ul>
<li>
<p>
where xx is your station number
</p>
</li>
<li>
<p>
Note <em>'#</em>' is the wildcard for all topics
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_11_setup_esp8266_to_publish_to_mqtt_broker_and_configure_a_node_red_flow_to_subscribe_to_mqtt_and_upload_to_the_cloud">LAB 11 :: Setup ESP8266 to publish to MQTT broker, and configure a Node-RED flow to subscribe to MQTT and upload to the cloud</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic" start="1">
<li>
<p>
If you do not have an account at adafruit.io, you will need to use a web browser and go to <a href="https://io.adafruit.com/">https://io.adafruit.com/</a>.
  Click on the &#8216;Get Started for Free&#8217; box on the top right of the screen. Enter the required info (Name, email, username, and password)
  and click on &#8216;Create Account&#8217;
</p>
</li>
<li>
<p>
If you did Lab 9, you can use that flow as a base for this one. Delete the email node, and go to Step 10 below.
</p>
</li>
<li>
<p>
Reload the MQTT sketch from Lab 4 or the ESPEASY Framework from lab 10 into your ESP8266.
</p>
</li>
<li>
<p>
On your Node-RED screen, click on the &#8216;+&#8217; button on the top right of the design screen to open another flow.
</p>
</li>
<li>
<p>
Double-click on the flow name to bring up its edit window. Change the name to &#8216;Cloud-Test&#8217;.
   Note that this is also where you would delete a flow that you no longer want. Click &#8216;Done&#8217;.
</p>
</li>
<li>
<p>
Drag a mqtt node from the input list onto the design screen. Note that there is also a mqtt node in the output section,
  which we do not want to use here.
</p>
</li>
<li>
<p>
Double-click on the mqtt node to bring up the edit window. Since your mosquitto broker and Node-RED are running on the same system,
  enter &#8216;localhost:1883&#8217; in the Server box.
</p>
</li>
<li>
<p>
Enter the topic name you used from Lab 4 or Lab 10 in the Topic box.
</p>
</li>
<li>
<p>
Change the QOS from 2 to 0.
</p>
</li>
<li>
<p>
Change the name to &#8216;MQTT subscribe&#8217; and hit &#8216;Done&#8217;.
</p>
</li>
<li>
<p>
Click and drag an mqtt output node from the &#8216;output&#8217; group. Note that you may have to scroll down to see this one.
  Make sure you get the output node (connector on the left) and not the input node (connector on the right).
</p>
</li>
<li>
<p>
Double-click the MQTT output node to bring up the edit window.
</p>
</li>
<li>
<p>
Select &#8216;Add new mqtt-broker&#8217; in the Server drop-down. Click on the edit icon to the right to configure a new MQTT broker.
</p>
</li>
<li>
<p>
Under the Connection tab enter <code>io.adafruit.com' in the `Server' box and `8883' in the 'Port' box.
  Check the `Enable secure (SSL/TLS) connection box</code>.
</p>
</li>
<li>
<p>
Select &#8216;Add new tls-config&#8217; in the TLS Configuration box, and the click the edit icon to the right. Enter the following paths:
       Certificate - $HOME/node_modules/adafruit-io/node_modules/mqtt/examples/tls client/tls-cert.pem
       Private Key - $HOME/node_modules/adafruit-io/node_modules/mqtt/examples/tls client/tls-key.pem
       CA Certificate - $HOME/node_modules/adafruit-io/node_modules/mqtt/examples/tls server/crt.server1.pem
</p>
</li>
<li>
<p>
Uncheck the <code>Verify server certificate box and enter a name (such as `My Cert') in the Name box.</code>
</p>
</li>
<li>
<p>
Click the &#8216;Update&#8217; button on the top right and make sure your new name is chosen in the TLS Configuration box.
  Click the &#8216;Add&#8217; button on the top right.
</p>
</li>
<li>
<p>
Click on the <code>Security</code> tab to bring up the login screen.
</p>
</li>
<li>
<p>
Enter your Adafruit username and password and click &#8216;Add&#8217;
</p>
</li>
<li>
<p>
You should now be back in the MQTT node edit panel. Make sure io.adafruit.com:8883 is in the &#8216;Server&#8217; box; and
  enter &lt;your adafruit login&gt;/feeds/IOTLab in the &#8216;Topic&#8217; and &#8216;Name&#8217; boxes. Click &#8216;Done&#8217; on the top right.
</p>
</li>
<li>
<p>
Connect the new <em>MQTT out node</em> to your previous <em>MQTT in node</em> and DEPLOY.
</p>
</li>
<li>
<p>
Log into your Adafruit account, and check for your Topic under Feeds.
  Note that you could be getting one every 15 seconds, so if it is working you may want to unplug the ESP8266 after a few minutes,
  or change the delay timer in your sketch.
</p>
</li>
</ol></div>
<div style="page-break-after:always"></div>
<div style="page-break-after:always"></div>
</div>
</div>
<div class="sect1">
<h2 id="_lab_setup_these_have_already_been_done">LAB SETUP :: These have already been done</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
SOFTWARE
</p>
<div class="ulist"><ul>
<li>
<p>
The Arduino IDE has been installed on the lab system.
</p>
<div class="ulist"><ul>
<li>
<p>
This can be found online at <a href="https://www.arduino.cc/en/main/software">https://www.arduino.cc/en/main/software</a>
</p>
<div class="ulist"><ul>
<li>
<p>
Version 1.8.5 was installed
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
The Arduino IDE has been configured to pick up the ESP8266 board definition by adding <em>http://arduino.esp8266.com/stable/package_esp8266com_index.json</em> to <em>File&#8594;Preferences&#8594;Settings</em> “Additional Boards Manager URLS”.
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://arduino-esp8266.readthedocs.io/en/latest/installing.html#boards-manager">http://arduino-esp8266.readthedocs.io/en/latest/installing.html#boards-manager</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
Arduino libraries and ESP8266 specific libraries have been installed
</p>
<div class="ulist"><ul>
<li>
<p>
In the Arduino IDE, Click on <em>Sketch&#8594;Include Libraries&#8594;Manage Libraries</em>
</p>
<div class="ulist"><ul>
<li>
<p>
The following libraries have been installed:
</p>
<div class="ulist"><ul>
<li>
<p>
ESP8266
</p>
</li>
<li>
<p>
Adafruit MQTT Library
</p>
</li>
<li>
<p>
DHT Sensor library by Adafruit
</p>
</li>
<li>
<p>
Adafruit Unified Sensor by Adafruit (dependency of DHT Sensor)
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
ESP8266 Arduino reference doc
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="http://arduino-esp8266.readthedocs.io/en/latest/">http://arduino-esp8266.readthedocs.io/en/latest/</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
The mosquitto MQTT broker has been installed. This can be found online at <a href="https://mosquitto.org/download/">https://mosquitto.org/download/</a> or by using “apt-get mosquitto”.
</p>
</li>
<li>
<p>
The Node-RED flow manager software has been installed. Instructions on how to do this can be found at <a href="https://nodered.org/docs/getting-started/installation">https://nodered.org/docs/getting-started/installation</a> .
</p>
</li>
</ul></div>
</li>
<li>
<p>
HARDWARE
</p>
<div class="ulist"><ul>
<li>
<p>
A NodeMCU ESP8266 development board has been mounted on a breadboardand wired up to a DHT11 temperature/humidity sensor.
</p>
<div class="ulist"><ul>
<li>
<p>
NodeMCU ESP8266 v1.0
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="https://github.com/nodemcu/nodemcu-devkit-v1.0">https://github.com/nodemcu/nodemcu-devkit-v1.0</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
DHT11 breakout board
</p>
<div class="ulist"><ul>
<li>
<p>
The + pin of the DHT11 goes to 3v3
</p>
</li>
<li>
<p>
The – pin of the DHT11 goes to GND
</p>
</li>
<li>
<p>
The OUT pin of the DHT11 goes to D5
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<div class="paragraph"><p><span class="image">
<img src="images/nodemcu-diy-iot_fritzing.png" alt="Fritzing Diagram of lab ESP8266" />
</span></p></div>
<div class="paragraph"><p><span class="image">
<img src="images/basic_breadboard_layout.png" alt="Solderless Breadboard Wiring" />
</span></p></div>
<div class="paragraph"><p><span class="image">
<img src="images/Arduino-IDE-illustration.png" alt="Arduino IDE Illustration" />
</span></p></div>
<div class="paragraph"><p><span class="image">
<img src="images/Node-red-illustration.png" alt="Node Red Illustration" />
</span></p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2018-05-01 09:56:49 CDT
</div>
</div>
</body>
</html>
